<?xml version="1.0" encoding="ISO-8859-1" ?>
<pipe:pipeline xmlns:pipe="http://cancerresearchuk.org/pipeline/1.2"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="http://cancerresearchuk.org/pipeline/1.2 http://uk-cri-lsol03:8080/solexa/solexa01/schema/workflow/pipeline-1.2.xsd">

    <name>ChipBamProcess Pipeline_P2</name>
    <description>Pipeline for generating Bam files processed for the ChIPseqPipeline.</description>

    <tasks>
     


	<specialisationSet name="WigCaller" type="WigCaller" variable="trio">

	<subtasks> 
       	

<!--	<task name="WigProcess" type="WigProcess">                  


			<resources>
                        <memory>4G</memory>
                    </resources>
                    
                
                    <inputs>
                	<input name="bam_processed">${BamDirectory}/${Test}.bam</input>
                	<input name="genome">${genomeFile}</input>
                    </inputs>

                    <outputs>
                        <output name="Wig">${WorkingDirectory}/Coverage/${Test}.wig</output>
                    </outputs>

	<arguments>
    	    <arg name="TheDirectory">${WorkingDirectory}</arg>
    	</arguments> 
    	</task>
-->
    	
	<task name="BedgraphProcess" type="BedgraphProcess">                  


		    <resources>
                        <memory>4G</memory>
                    </resources>
                    
                
                    <inputs>
                	<input name="bam_processed">${BamDirectory}/${Test}.bam</input>
                	<input name="genome">${genomeFile}</input>
                    </inputs>

                    <outputs>
                        <output name="Bedgraph">${WorkingDirectory}/Coverage/${Test}.bedgraph</output>
                    </outputs>

	<arguments>
    	    <arg name="TheDirectory">${WorkingDirectory}</arg>
    	</arguments> 


                </task>

        <task name="WigHistogram" type="WigHistogram">
	                    <resources>
	                        <memory>4G</memory>
	                    </resources>
	                   
	                    <inputs>
                		<input name="bam_processed">${BamDirectory}/${Test}.bam</input>
                		<input name="genome">${genomeFile}</input>
	                    </inputs>
	
	                    <outputs>
	                        <output name="Histogram">${WorkingDirectory}/Coverage/${Test}.hist</output>
	                    </outputs>

	<arguments>
    	    <arg name="TheDirectory">${WorkingDirectory}</arg>
    	</arguments> 

	</task>
                
 
	        <task name="BigWigProcess" type="BigWigProcess">
	        <depends>
		     <task>BedgraphProcess</task>
	   	</depends>
	           <resources>
	               <memory>4G</memory>
	           </resources>
	                    
	           <inputs>
                		<input name="Wig">${WorkingDirectory}/Coverage/${Test}.bedgraph</input>
                		<input name="genome">${genomeFile}</input>
	           </inputs>
	    
	           <outputs>
	               <output name="BigBed">${WorkingDirectory}/Coverage/${Test}.bw</output>
	           </outputs>

	<arguments>
    	    <arg name="TheDirectory">${WorkingDirectory}</arg>
    	</arguments> 

	        </task>

	     </subtasks>
      </specialisationSet>


	<task name="OrganiseCoverageStats" type="OrganiseCoverageStats">
     	<depends>
		<task>WigCaller</task>
   	</depends>  
  
	<outputs>
       	 <output name="CovPlot">${WorkingDirectory}/Coverage/TempPlot.png</output>
    	</outputs>
  	  	<arguments>
		<arg name="TheCovDirectory">${WorkingDirectory}/Coverage/</arg>
    		</arguments> 

            
	</task>

    </tasks>
</pipe:pipeline>







